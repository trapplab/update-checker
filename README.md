# Sample App

Minimal Flutter starter template with i18n (5 languages), three build flavors (GitHub, F-Droid, Google Play), and CI/CD scaffolding.

## Quick Start

```bash
# 1. Prepare a flavor
./scripts/prepare_flavor.sh github

# 2. Run the app
flutter run --flavor github
```

## Using a Local Flutter SDK

Instead of relying on a system-wide Flutter installation, you can pin an exact Flutter version by adding it as a git submodule inside the project:

```bash
# Add Flutter as a submodule (pick a stable tag)
git submodule add -b stable https://github.com/flutter/flutter.git flutter

# Pin to a specific version
cd flutter && git checkout 3.29.3 && cd ..
git add flutter
git commit -m "Pin Flutter SDK to 3.29.3"
```

Then use the local binary everywhere instead of the global `flutter` command:

```bash
./flutter/bin/flutter pub get
./flutter/bin/flutter run --flavor github
./flutter/bin/flutter build apk --flavor github --release
```

This ensures all developers and CI use the identical SDK version. The `prepare_flavor.sh` script auto-detects a local `./flutter/bin/flutter` if present and uses it instead of the system binary. To enable this, the CI workflow can check out submodules:

```yaml
- uses: actions/checkout@v4
  with:
    submodules: true
```

## Customize This Template

### 1. Rename the project

Search and replace these placeholders across the project:

| Placeholder | Replace with | Example |
|---|---|---|
| `sample_app` | your Dart package name (snake_case) | `my_cool_app` |
| `Sample App` | your display name | `My Cool App` |
| `com.example.sample_app` | your application ID | `com.mycompany.my_cool_app` |
| `com/example/sample_app` | matching directory path | `com/mycompany/my_cool_app` |

Files to update:
- `pubspec.yaml`, `pubspec.fdroid.yaml`, `pubspec.play.yaml` — `name:` field
- `android/app/build.gradle.kts` — `namespace` and `applicationId`
- `android/app/src/main/AndroidManifest.xml` — `android:label`
- `android/app/src/main/kotlin/com/example/sample_app/MainActivity.kt` — package declaration, and rename the directory path to match
- `fastlane/Appfile` — `package_name`
- `LICENSE` — `YOUR_NAME_HERE`

### 2. Add platforms

This template ships with Android only. Add more platforms:

```bash
# Add iOS and Web support
flutter create --platforms ios,web .

# Add Linux desktop support
flutter create --platforms linux .
```

### 3. Install the pre-commit hook

```bash
ln -sf scripts/git-hooks/pre-commit .git/hooks/pre-commit
```

This enforces version consistency across `pubspec.yaml`, `pubspec.fdroid.yaml`, `pubspec.play.yaml`, and `Changelog.md`. It also auto-generates translated changelogs for fastlane.

### 4. Set up changelog translation (optional)

The `update_changelogs_with_translation.sh` script uses the OpenAI API to translate changelogs. Create a `.env` file:

```
OPENAI_API_TOKEN=sk-...
```

## Build Flavors

| Flavor | pubspec | Description |
|---|---|---|
| `github` | `pubspec.fdroid.yaml` | GitHub Releases distribution |
| `fdroid` | `pubspec.fdroid.yaml` | F-Droid distribution |
| `play` | `pubspec.play.yaml` | Google Play (includes `in_app_purchase`) |

### Prepare and build

```bash
# GitHub APK
./scripts/prepare_flavor.sh github
flutter build apk --flavor github --release

# F-Droid APK
./scripts/prepare_flavor.sh fdroid
flutter build apk --flavor fdroid --release

# Play Store AAB
./scripts/prepare_flavor.sh play
flutter build appbundle --flavor play --release
```

## Internationalization

Supported locales: English, German, Spanish, French, Italian.

Translation files live in `lib/l10n/app_*.arb`. After editing:

```bash
flutter gen-l10n
```

To add a new language, see [AGENTS.md](AGENTS.md).

## Version Bumping

See [AGENTS.md](AGENTS.md) for the version bump procedure. Version code formula: `MAJOR * 10000 + MINOR * 100 + PATCH`.

## CI/CD

- `.github/workflows/build-and-release-apk.yml` — builds GitHub APK on tag push and deploys Play Store AAB
- `fastlane/` — Google Play deployment via `fastlane open_test`

## Project Structure

```
lib/
  main.dart              # App entry point with i18n
  config/
    config.dart          # Flavor boolean helpers
    flavor_config.dart   # Generated by prepare_flavor.sh
  l10n/
    app_*.arb            # Translation files
scripts/
  prepare_flavor.sh      # Switch between build flavors
  git-hooks/pre-commit   # Version consistency checks
```

## License

MIT. See [LICENSE](LICENSE).
